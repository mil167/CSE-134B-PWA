<!--
gamestats.html
File size: 2KB
Load time: 359ms to paint
 -->

<!DOCTYPE HTML>
<html>
<head>
	<title>Game Stats</title>
	<link rel="stylesheet" href="hw4_gamestats.css">
</head>
<body>
	<p>
    <a href="http://jigsaw.w3.org/css-validator/check/referer">
        <img style="border:0;width:88px;height:31px"
            src="http://jigsaw.w3.org/css-validator/images/vcss"
            alt="Valid CSS!" />
    </a>
    </p>
    <p>
   <a href="https://validator.w3.org/check?uri=referer"><img
       src="http://www.w3.org/Icons/valid-xhtml10"
       alt="Valid XHTML 1.0!" height="31" width="88" /></a>
</p>

<script>
	//Taken from https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
	//Used instead of php to do content generation solely in js
	var urlParams;
	(window.onpopstate = function () {
	    var match,
	        pl     = /\+/g,  // Regex for replacing addition symbol with a space
	        search = /([^&=]+)=?([^&]*)/g,
	        decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
	        query  = window.location.search.substring(1);

	    urlParams = {};
	    while (match = search.exec(query))
	       urlParams[decode(match[1])] = decode(match[2]);
	})();
</script>
<script src="mockmain.js"></script>


	<h1 id=match></h1>
	<h2 id=score></h2>
	<h3 id=highlightsTitle></h3>
	<ol id="highlights">
	</ol>
	<br>
	<h3 id="playersTitle"></h3>
	<table id="playerTable">
		<tbody id="players">
		</tbody>
	</table>
	<br>
	<div id="vods">
		<p><a id="vod">VOD</a></p>
		<p><a id="hlvod">Highlights VOD</a></p>
	</div>
	<footer>
		<hr>
		<ul>
		 <li><a href="home.html">Home</a></li>
		 <li><a href="roster1.html">Roster</a></li>
		 <li><a href="hw4_schedule.html">Schedule</a></li>
		</ul>
	</footer>

  <script>
    var gamestatsRender = function(){
      let pageMatch = getSchedule()[urlParams["matchID"]];
      if(pageMatch.finished){
        document.querySelector("#match").innerHTML = "VS " + pageMatch.enemyTeam + " " + pageMatch.date;
        document.querySelector("#score").innerHTML = "" + getTeam().name + " " + pageMatch.ourScore + " - " + pageMatch.enemyTeam + " " + pageMatch.enemyScore;
        document.querySelector("#score").className = pageMatch.won ? "won" : "lost";
        document.querySelector("#highlightsTitle").innerHTML = "Highlights";
        document.querySelector("#playersTitle").innerHTML = "Players";
        let pageHighlights = document.querySelector("#highlights");
        highlights.innerHTML = "";
        for(highlight in pageMatch.highlights){
          let hightlightLi = document.createElement('li');
          hightlightLi.innerHTML = "<p><strong>" + pageMatch.highlights[highlight].time + "':</strong>&emsp;" + pageMatch.highlights[highlight].desc + "</p>";
          pageHighlights.appendChild(hightlightLi);
        }
        let pagePlayers = document.querySelector("#players");
        pagePlayers.innerHTML = "";

        let headerrow = document.createElement('tr');
        let teamheader = document.createElement('th');
        teamheader.innerHTML = "<p>" + getTeam().name + "</p>";
        headerrow.appendChild(teamheader);
        let teamheader2 = document.createElement('th');
        teamheader2.innerHTML = "<p>" + pageMatch.enemyTeam + "</p>";
        headerrow.appendChild(teamheader2);
        pagePlayers.appendChild(headerrow);

        let pageTeam = getTeam();
        let enemyPageTeam = getTeamByName(pageMatch.enemyTeam);
        for(player in pageTeam.players){
          let playerTD = document.createElement('td');
          playerTD.innerHTML = "<p>" + pageTeam.players[player].name + "</p>";
          let playerRow = document.createElement('tr');
          playerRow.appendChild(playerTD);
          let enemyPlayerTD = document.createElement('td');
          if(enemyPageTeam && enemyPageTeam.players && enemyPageTeam.players[player]){
            enemyPlayerTD.innerHTML = "<p>" + enemyPageTeam.players[player].name + "</p>";
          }
          playerRow.appendChild(enemyPlayerTD);
          pagePlayers.appendChild(playerRow);
        }
        if(pageMatch.vod != ""){
          document.querySelector("#vod").href = pageMatch.vod;
        }
        if(pageMatch.hlvod != ""){
          document.querySelector("#hlvod").href = pageMatch.hlvod;
        }
      }
      else if(pageMatch.practice){
        document.querySelector("#match").innerHTML = "Practice " + " " + pageMatch.date;
      }
      else{

      }
    }
    gamestatsRender();
  </script>
</body>
</html>
